<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CountDown Clock</title>
  <style>
    .clock{
      background-color: blue;
      width: 400px;
      text-align: center;
      color: white;
      font-size: 1em;
    }
    
    .clock > span {
      padding: 10px;
      border-radius: 10px;
      background-color: black;
    }
    
    .clock > span > span {
      padding: 5px;
      border-radius: 10px;
      /**background-color: red;**/
    }
    
    input {
      padding: 15px;
      margin: 20px;
      font-size: 1.5em;
    }
  </style>
</head>

<body>
  <div>
    <input type="date" name="endDate" id="endDate">
    <div class="clock">
      <span class="days">0</span>
      <span class="hours">0</span>
      <span class="minutes">0</span>
      <span class="seconds">0</span>
    </div>
  </div>
  <div id="message"></div>
  
  <script type="text/javascript" charset="utf-8">
    let input = document.querySelector('#endDate');
    let clock = document.querySelector('.clock');
    let days = document.querySelector('.days');
    let hours = document.querySelector('.hours');
    let minutes = document.querySelector('.minutes');
    let seconds = document.querySelector('.seconds');
    
    let message = document.querySelector('#message');
    
    let timeInterval;
    let counterActive =  false;
    
    input.addEventListener('change', () => {
      localStorage.setItem('endDate', input.value);
      console.log(localStorage.getItem('endDate'));
      reset();
    });
    
    if (localStorage.getItem('endDate')) {
      input.value = localStorage.getItem('endDate');
      startCountdown();
    }
    
    function reset() {
      clearInterval(timeInterval);
      startCountdown();
    }
    
    function formatNumber(num) {
      return num < 10 ? '0' + num : num;
    }

    function startCountdown () {
      let countDown = input.value;
      let targetDate = new Date(countDown);
      console.log(targetDate.toString());
      
      timeInterval = setInterval(() => {
        let todayDate = new Date();
        let timeLeft = targetDate - todayDate;
        console.log(timeLeft);
        
        let daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        let hoursLeft = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        let minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        let secondsLeft = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        console.log(daysLeft, hoursLeft, minutesLeft, secondsLeft);
        
        days.textContent = formatNumber(daysLeft);
        hours.textContent = formatNumber(hoursLeft);
        minutes.textContent = formatNumber(minutesLeft);
        seconds.textContent = formatNumber(secondsLeft);
        
        if (timeLeft <= 0) {
          clearInterval(timeInterval);
          days.textContent = 0;
          hours.textContent = 0;
          minutes.textContent = 0;
          seconds.textContent = 0;
          
          message.textContent = "ðŸŽ‰ Countdown Finished!";
        } 
      }, 1000)
    }
    
  </script>
</body>

</html>